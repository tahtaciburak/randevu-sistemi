<!-- views/index.ejs -->
<!doctype html>
<html>
<% include ./header %>
<body >
    <div class="container">
        
        <h3><b>Randevu Al</b></h3>
        
        <div>
            
                <div class="form-row align-items-center">
                  <div class="col-sm">
                    <label class="sr-only" for="inlineFormInputName">Kişi, Kurum ve Etiketlerde Arayın...</label>
                    <input type="text" class="form-control" id="SearchInput" placeholder="Kişi, Kurum ve Etiketlerde Arayın...">
                  </div>
                  
                  <div class="col-auto my-1">
                    <button onclick="search()" class="btn btn-primary"><span class="fas fa-search"></span> Ara</button>
                  </div>
                </div>
              
              
        </div>

        <!-- Bulunan sonuçlar -->
        
        
        <div id="error_msg"class="alert alert-warning" style="margin:15px 0;"><b>"yıldız"</b> için bulunan sonuçlar :</div>
        
        <table class="table table-borderless">
            <thead>
              <tr> 
                <th scope="col"><span class="fas fa-address-book"></span> Kullanıcı Adı</th>
                <th scope="col"><span class="fas fa-tag"></span> Randevu Açıklaması</th>
                <th scope="col"><span class="fas fa-building"></span> Lokasyon</th>
                <th scope="col"><span class="fas fa-user"></span> Zaman</th>
                <th scope="col"><span class="fas fa-eye"></span> </th>
              </tr>
            </thead>
            <tbody id="tableContent">
              
            </tbody>
          </table>
    </div>
      <!-- Modal -->
      <div class="modal fade" id="exampleModalLong" style="padding-top:100px;" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLongTitle">Randevu Al</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              Randevu veren kişinin takvimi bu modalda görüntülenir.
              
              <form>
                <div class="form-group">
                  <label for="aciklama">Randevu Hakkında Kısa Açıklama:</label>
                  <input type="text" class="form-control" id="aciklama" placeholder="Randevu hakkında açıklamanız">
                </div>
                <div class="form-group">
                  <div class="custom-file">
                      <input type="file" class=" form-control custom-file-input" id="inputGroupFile02">
                      <label class=" form-control custom-file-label" for="inputGroupFile02">Ek halinde dosya yükleyin</label>
                    </div>
                  </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary " data-dismiss="modal">İptal</button>
              <div id="takeAppointment" type="button" class="btn btn-primary btn-block">Onayla</div>
            </div>
          </div>
        </div>
      </div>



    <script>
        function search(){
            let searchQuery = $('#SearchInput').val();
            

            $.getJSON("/appointments/search/"+searchQuery,function(data){
              updateTable(data);
            })
        }

        function updateTable(data){
         
          let tableContents ="";
          data.forEach(element => {
            tableContents += 
             "<tr ><td>" + element.username +"</td>"
            +"<td>" + element.AppointmentHeader +"</td>"
            +"<td>" + element.Location +"</td>"
            +"<td>" + element.StartDateTime +"</td>"
            +'<td><button class="btn btn-success btn-block" onclick="take('+element.AppointmentID +')"><span class="fas fa-arrow-circle-right "></span> Al</button></td>'   
            +" </tr>";
          });

           $('#tableContent').html(tableContents);
        }
        
        function take(appID){
            $('#exampleModalLong').modal('toggle');
            
            document.getElementById('takeAppointment').onclick = function(){
              let desc = $('#aciklama').val();
              console.log("Yolla",desc)
              $.post( '/appointments/take', { AppointmentID : appID })
              .done(function( data ) {
                console.log(JSON.stringify(data))
              });
            }

        }

    </script>
</body>
</html>